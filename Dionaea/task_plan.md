# Implementation Plan: Dionaea Log Statistics Module

## 1. Environment Setup
- [ ] Create `docker-compose.yml` for Redis.
- [ ] Start Redis service.
- [ ] Verify `backend/app` dependencies (ensure `redis`, `uvicorn`, `fastapi`, `sqlalchemy` are installed).

## 2. Backend Development (FastAPI)
- [ ] **Database Model Update**:
    - Modify `backend/app/models/attack_log.py` to include `target_port`, `connection_status`.
    - Create migration (or just update `init_db` for this env since it uses SQLite/re-create).
- [ ] **Schemas**:
    - Create `backend/app/schemas/attack_log.py` for response models.
- [ ] **Service Layer**:
    - Create `backend/app/services/attack_log_service.py`.
    - Implement log querying with filters (time, IP, user/pass).
    - Implement statistics aggregation (Top IPs, Users, Passwords).
    - Implement Redis caching (10 mins TTL).
    - Implement `Login_statistics.sh` execution and parsing.
- [ ] **API Endpoints**:
    - Update/Create `backend/app/api/v1/data.py`.
    - `GET /data/logs`: List logs (paginated).
    - `GET /data/stats/charts`: Return data for ECharts.
    - `GET /data/stats/summary`: Return `Login_statistics.sh` output.
    - `POST /data/refresh`: Trigger statistics update (called by `Check.sh`).

## 3. Frontend Development (Vanilla JS + ECharts)
- [ ] **HTML Structure**:
    - Update `dashboard.html` to add "System Monitoring" and "Data Statistics" sections.
    - Add ECharts container and Log Table container.
- [ ] **Dashboard Logic (`dashboard.js`)**:
    - Integrate ECharts library (CDN).
    - Implement `renderCharts()` function.
    - Implement `renderLogTable()` with pagination/virtual scrolling support.
    - Implement "Statistics Summary" panel updates.
- [ ] **Interaction**:
    - Add click handlers for charts (drill-down).
    - Add refresh mechanism for summary panel.

## 4. Script Integration
- [ ] **Check.sh Modification**:
    - Modify `Check.sh` to call the backend refresh endpoint when logs change.
    - Or ensure `Check.sh` output is readable by backend.

## 5. Testing & Documentation
- [ ] **Unit Tests**:
    - Create `backend/tests/test_data_api.py`.
    - Test filtering, pagination, and stats.
- [ ] **Stress Test**:
    - Run `ab -n 1000 -c 100` against the API.
- [ ] **Documentation**:
    - Generate Swagger docs (auto-generated by FastAPI).
    - Write deployment instructions.
